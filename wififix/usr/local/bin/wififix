#!/usr/bin/env python3

from gi.repository import GObject
from pydbus import SessionBus
import os


def reset_driver():
    os.system('sudo modprobe -r rtl8192ee')
    os.system('sudo modprobe rtl8192ee')


def event_handler(sender, object, iface, signal, params):
    if signal.lower() == "unlocked":
        reset_driver()

if __name__ == '__main__':
    print('Starting...')
    reset_driver()

    loop = GObject.MainLoop()
    bus = SessionBus()
    bus.subscribe(object='/com/canonical/Unity/Session',
                  iface='com.canonical.Unity.Session',
                  signal_fired=event_handler)

    print('All good.')
    try:
        loop.run()
    except KeyboardInterrupt:
        pass
